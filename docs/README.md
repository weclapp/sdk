## Usage

This SDK is split into services. Each service is responsible for a _single_ entity (e.g. `Party`). Every service contains all functions available for this
entity, this may include functions such as `update`, `delete`, `some` and many more.

To initialize a service a `ServiceConfig` is needed, you can specify a global config in case you don't want to pass the config every time to the service you
want to use manually.

Check out [generated types and utilities](#generated-types-and-utilities) for more possibilities!

### The Service Configuration

The configuration looks like the following (taken from [globalConfig.ts](/src/generator/01-base/static/globalConfig.ts.txt)):

```ts
interface ServiceConfig {

    // Your API-Key, this is optional in the sense of if you omit this, and you're in a browser, the
    // cookie-authentication (include-credentials) will be used.
    key?: string;

    // Your domain, if omitted location.host will be used.
    domain?: string;

    // If you want to use https, defaults to true.
    secure?: boolean;

    // If you want that some and count requests are bundled into multi requests.
    multiRequest?: boolean;

    // If you want that the ignoreMissingProperties parameter to be set for each post request.
    ignoreMissingProperties?: boolean;

    // Optional request/response interceptors.
    interceptors?: {

        // Takes the generated request, you can either return a new request,
        // a response (which will be taken as "the" response) or nothing.
        // The payload contains the raw input generated by the SDK.
        request?: (request: Request, payload: RequestPayload) => Request | Response | void | Promise<Request | Response | void>;

        // Takes the response. This can either be the one from the server or an 
        // artificially-crafted one by the request interceptor.
        response?: (response: Response) => Response | void | Promise<Response | void>;
    };
}
```

There are three ways of accessing a service through the SDK:

#### Using a Global Config

```ts
import { setGlobalConfig, partyService } from '@weclapp/sdk';

setGlobalConfig({
    key: 'mykey',
    domain: 'myweclapp.com'
});

const party = partyService();

console.log(`Total amount of parties: ${await party.count()}`)
```

#### Using a Config per Service

```ts
import { partyService } from '@weclapp/sdk';

const party = partyService({
    key: 'mykey',
    domain: 'myweclapp.com'
});

console.log(`Total amount of parties: ${await party.count()}`)
```

> If a global config is specified as well the one passed to the service will **always** take precedence over the global one!

#### Using the raw function

The raw function can be used if none of the provided function suits your needs:

```ts
import { raw } from '@weclapp/sdk';

const result = await raw(
    cfg: ServiceConfig | undefined = globalConfig,
    endpoint: string,
    payload: RequestPayload = {}
);
```

where `RequestPayload` looks like this:

```ts
interface RequestPayload {
    method?: RequestPayloadMethod; // Optional request method, default is GET
    query?: Record<string, any>; // Optional query parameters
    body?: any; // Optional body

    // In case the response body is an object with a result-prop the value will be extracted
    unwrap?: boolean;

    // If in any case the response should be returned as a blob.
    // Required for download endpoints as json will be parsed automatically.
    forceBlob?: boolean;
}
```

## Generated types and utilities

The generator generates various utilities that can be used to integrate it in a generic way into your app.

### Exported constants

| Constant                    | Description                                                                                                            |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------|
| `wServiceWith[method]Names` | An array of services (strings) that have this function. Example: `wServiceWithUpdateNames`.                            |
| `wCustomValueServiceNames`  | An array of services (strings) that work with `CustomValue`.                                                           |
| `wEnums`                    | Object with the name of the enum as key and the corresponding enum as value.                                           |
| `wServiceFactories`         | Object with all services where the name is the key and the value a function taking a config and returning the service. |
| `wServices`                 | Object with all services where the name is the key and the value the service (that is using the global config).        |
| `wEntityProperties`         | Object with all entity names as key and properties including the type and format as value.                             |

### Exported types

| Type                    | Description                                                                                                 | Type guards available?                | 
|-------------------------|-------------------------------------------------------------------------------------------------------------|---------------------------------------|
| `WServiceWith[method]`  | A tuple of strings with the names of the services that contain this function. Example: `WServiceWithSome`.  | Yes, for example `isWServiceWithSome` |
| `WServicesWith[method]` | An interface with the service-name as key and corresponding service as value. Example: `WServicesWithSome`. |                                       |
| `WCustomValueService`   | Tuple of services (strings) that work with `CustomValue`.                                                   | Yes: `isWCustomValueService`          |
| `WEnums`                | Type of `wEnums`.                                                                                           |                                       |
| `WEnum`                 | All keys of `WEnums`.                                                                                       |                                       |
| `WEntities`             | Interface will all entities from weclapp with their name as key and type as value                           |                                       |
| `WEntity`               | All keys of `WEntities`.                                                                                    |                                       |
| `WServiceFactories`     | Type of `wServiceFactories`.                                                                                |                                       |
| `WServices`             | Type of `wServices`.                                                                                        |                                       |
| `WEntityProperties`     | Generalized type of `wEntityProperties`.                                                                    |                                       |
