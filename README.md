<br/>
<br/>

<div align="center">
    <img src="/uploads/1dedf37d0e1e105f9e94ea97e04ca096/logo.svg" alt="Logo" width="350"/>
</div>

<br/>

<div align="center">
    <h3>SDK Generator</h3>
</div>

## Quick start

The following README is about the CLI - for the generated SDK please refer to the [user manual](MANUAL.md).

1. Copy the [.env.example](.env.example) to [.env](.env) and configure it accordingly. Make sure to set NODE_ENV to `development`.
2. Run `npm run sdk:dev`.
3. Run `./bin/cli.js -h` for usage information.

> During development the SDK will be build into the [sdk](./sdk) folder, in production the root folder will be used.
> For usage information please consult the [manual](MANUAL.md).

## Project structure

Most of them are auto-generated.

| Folder | Description |
| ----- | ----- |
| [/static](static) | Static files, most of them (!) will be copied straight to the SDK repository itself. |
| [/static/types](static/types) | Static types, which can be imported and used by the generated SDK. |
| [/static/docs](static/docs) | Documentation templates, filled by the generator and copied to [sdk/docs](sdk/docs). |
| [/src](src) | Source code for the generator itself. |
| [/sdk](sdk) | During development, the generated repository will end up here. Source-files are bundle via [rollup](https://rollupjs.org/). |
| [/sdk/src](sdk/src) | Will contain the raw source files generated by the generator.  |

Based on the project structure, building is done in two steps:
1. Generating the raw SDK code into [sdk/src](sdk/src) and partial documentation into [sdk/docs](sdk/docs).
2. Bundling the code in [sdk/src](sdk/src) into the given targets (for example [sdk/node](sdk/node)).

After building it, check out the generated repository under [sdk](sdk) for further documentation!

## Setup

 Use the [swagger editor](https://editor.swagger.io/) to convert your
swagger.json to the [OpenAPI v3](https://swagger.io/specification/) format. 

### Development

There are a few scripts for development:

* `npm run sdk:dev` _- Watches the SDK CLI and rebuilds it on every change._
* `npm run lint:fix` _- Lints both the generator, and the generated SDK. Fixes errors where possible._
* `npm run test:coverage` _- Test the SDK and collect code-coverage._


To use your freshly created SDK, you can refer to it locally to test it (replace `SDK_PATH` with the absolute path of the [SDK](sdk)): 
```json5
{
    // ...inside of your package.json
    "dependencies": {
        "@weclapp/sdk": "file:SDK_PATH",
        // ...other dependencies...
    }
}
```

### Production

To generate a production-ready SDK, simply run `npm run build`. This will generate the SDK and bundle it into the [SDK](sdk) folder. The process should finish without
errors.

The [Dockerfile](Dockerfile) will install all dependencies for this project. After building it, it can be used to generate the sdk and test it.
For this environmental variables must be set and `npm` commands run in the container.

##### Testing

If you also want to run tests you'll _additionally_ need the following:
* `RUN_TESTS` _- Set to `true` (or any other non-empty value)._
* `TEST_DOMAIN` _- API domain to test against, **prerel1 has to be used** (e.g. `fueller2.test1-y4jnp8qvg1.internal.weclapp.com`).
  The background is, that the tests create entities via the sdk in the system. In case deletion fails the production environment would be polluted,
  but the prerel1 systems lose the data after migration to next weclapp version_
* `TEST_API_KEY` _- API-Key._
